/* --- BASE & LAYOUT --- */
*, *::before, *::after { box-sizing: border-box; }

body {
    margin: 0;
    font-family: var(--font-family);
    background: var(--gradient-bg);
    color: var(--text-primary);
    font-size: var(--font-size-base);
    transition: background-color var(--transition-speed) ease-out, color var(--transition-speed) ease-out;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
}

.app-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0.75rem 1.5rem;
    background-color: var(--card-bg);
    border-bottom: 1px solid var(--card-border);
    position: sticky;
    top: 0;
    z-index: 100;
    box-shadow: 0 2px 10px var(--shadow-color);
}

.app-title { font-family: var(--font-family-headings); font-size: 1.25rem; margin: 0; font-weight: 700; }
.header-actions { display: flex; align-items: center; gap: 0.5rem; }

/* UPDATED: Wider max-width for better use of large screens */
.app-main { padding: 1.5rem; max-width: 1600px; margin: 0 auto; }
.main-content-grid { display: grid; grid-template-columns: 1fr; gap: 1.5rem; align-items: flex-start; }
@media (min-width: 960px) {
    /* UPDATED: Give more space to the primary content column */
    .main-content-grid { grid-template-columns: 3fr 1fr; }
}

.sr-only { position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px; overflow: hidden; clip: rect(0, 0, 0, 0); white-space: nowrap; border-width: 0; }


/* --- UNIVERSAL FOCUS & INTERACTIONS --- */
:focus-visible {
    outline: none;
    box-shadow: 0 0 0 4px color-mix(in srgb, var(--accent-primary) 25%, transparent) !important;
}

.icon-btn:active, .btn-biller-card:active { transform: scale(0.95); }


/* --- NOTIFICATION BANNER --- */
.notification-banner {
    padding: 1rem;
    border-radius: var(--radius-md);
    font-weight: 500;
    margin-bottom: 1.5rem;
    animation: fadeIn 0.3s ease-out;
    border: 1px solid transparent;
}
.notification-banner.is-error { background-color: var(--danger); color: white; }
.notification-banner.is-success { background-color: var(--success); color: white; }


/* --- CORE COMPONENTS --- */
.icon-btn {
    position: relative;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background: transparent;
    border: none;
    color: var(--text-secondary);
    cursor: pointer;
    font-size: 1.1rem;
    transition: all var(--transition-fast) ease-out;
}
.icon-btn:hover { background-color: var(--accent-secondary); color: var(--text-primary); }

.search-container, .content-primary { display: flex; flex-direction: column; gap: 1.5rem; }
.search-wrapper { position: relative; }

.search-wrapper .search-icon {
    position: absolute;
    top: 50%;
    left: 1.25rem;
    transform: translateY(-50%);
    color: var(--text-tertiary);
    pointer-events: none;
    z-index: 1;
}

.search-input {
    width: 100%;
    padding: 1rem 1.25rem 1rem 3.5rem;
    font-size: 1.25rem;
    border-radius: var(--radius-lg);
    border: 1px solid var(--card-border);
    background-color: var(--card-bg);
    color: var(--text-primary);
    box-shadow: 0 4px 12px var(--shadow-color);
    transition: all var(--transition-speed) ease-out;
}

.suggestions-list {
    position: absolute;
    top: calc(100% + 8px);
    left: 0;
    right: 0;
    background-color: var(--card-bg);
    border: 1px solid var(--card-border);
    border-radius: var(--radius-md);
    max-height: 300px;
    overflow-y: auto;
    z-index: 20;
    box-shadow: 0 8px 16px var(--shadow-color);
    padding: 0.25rem;
    margin: 0;
    list-style: none;
}
.suggestion-item {
    padding: 0.75rem 1.25rem;
    cursor: pointer;
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-radius: var(--radius-md);
}
.suggestion-item.is-active, .suggestion-item:hover { background-color: var(--accent-secondary); }

/* Biller & Location Cards */
.biller-card { 
    background-color: var(--card-bg); 
    border: 1px solid var(--card-border); 
    border-radius: var(--radius-md); 
    padding: 1.5rem; 
    animation: fadeIn 0.3s ease-out;
    transition: transform var(--transition-speed) ease-out, box-shadow var(--transition-speed) ease-out;
}
.biller-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 20px var(--shadow-color);
}

.card-header { 
    display: flex; 
    flex-wrap: wrap;
    align-items: center; 
    justify-content: space-between; 
    gap: 0.5rem 1rem; 
    padding-bottom: 1rem;
    border-bottom: 1px solid var(--card-border);
}
.card-title-group { display: flex; align-items: center; gap: 0.75rem; }
.card-title { font-family: var(--font-family-headings); font-size: 1.75rem; font-weight: 700; margin: 0; }
.icon-btn-favorite { font-size: 1.5rem; color: var(--text-tertiary); width: 36px; height: 36px; }
.icon-btn-favorite.is-favorite { color: var(--warning); }
.card-header-meta { display: flex; align-items: center; gap: 0.75rem; }
.payment-type-tag, .card-status { 
    padding: 0.25rem 0.75rem; 
    border-radius: 999px; 
    font-size: 0.8rem; 
    font-weight: 500; 
    white-space: nowrap;
    background-color: var(--accent-secondary);
    color: var(--text-secondary);
}
.card-status.is-live { background-color: var(--success); color: white; }
.card-status.is-offline { background-color: var(--danger); color: white; }

/* NEW: Biller Action Bar Styles */
.biller-action-bar {
    display: flex;
    flex-wrap: wrap;
    align-items: center;
    justify-content: space-between;
    gap: 1rem;
    margin: 1.25rem 0;
}
.action-bar-buttons { display: flex; flex-wrap: wrap; gap: 0.75rem; }
.action-bar-contacts { display: flex; flex-wrap: wrap; gap: 1.5rem; }

.quick-link-item > strong {
    display: block;
    color: var(--text-secondary);
    font-size: 0.9rem;
    margin-bottom: 0.25rem;
}
.copyable-field.compact {
    padding: 0;
    background-color: transparent;
    font-size: 1rem;
    font-weight: 500;
}
.copyable-field.compact .icon-btn-copy {
    width: 28px;
    height: 28px;
    font-size: 0.85rem;
}

.btn-biller-card { padding: 0.6rem 1.25rem; border: 1px solid; border-radius: var(--radius-md); font-size: 0.9rem; font-weight: 600; cursor: pointer; display: inline-flex; align-items: center; justify-content: center; gap: 0.5rem; transition: all var(--transition-speed) ease-out; text-decoration: none; }

/* UPDATED: New primary button style for Knowledge Base */
.btn-kb { background-color: #0db0ab; color: white; border-color: #0db0ab; }
.btn-kb:hover { background-color: #0a8d88; border-color: #0a8d88; }
.btn-ad { background-color: transparent; color: var(--text-secondary); border-color: var(--card-border); }
.btn-ad:hover { background-color: var(--accent-secondary); color: var(--text-primary); }

.card-grid { display: grid; grid-template-columns: 1fr; gap: 1.25rem; }
.copyable-field { display: flex; align-items: center; justify-content: space-between; gap: 0.75rem; }
.icon-btn-copy { flex-shrink: 0; width: 32px; height: 32px; font-size: 0.9rem; color: var(--text-secondary); }
.icon-btn-copy:hover { background-color: var(--accent-secondary-hover); }
.icon-btn-copy.is-copied { color: var(--success) !important; background-color: transparent !important; }

/* Location Info Card Styles */
.location-card-title { font-family: var(--font-family-headings); font-size: 1.5rem; font-weight: 700; margin: 0 0 1rem 0; color: var(--text-primary); border-bottom: 1px solid var(--card-border); padding-bottom: 1rem; }
.associated-billers-title { font-size: 1rem; font-weight: 600; color: var(--text-secondary); margin: 1.5rem 0 0.75rem 0; }
.associated-billers-list { list-style: none; padding: 0; margin: 0; display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 0.75rem; }
.biller-link-item { display: flex; align-items: center; gap: 0.75rem; padding: 0.75rem 1rem; background-color: var(--accent-secondary); color: var(--text-primary); border-radius: var(--radius-md); text-decoration: none; font-weight: 500; transition: background-color var(--transition-fast) ease-out, color var(--transition-fast) ease-out; cursor: pointer; border: none; width: 100%; text-align: left; font-size: 1rem; }
.biller-link-item:hover { background-color: var(--accent-primary); color: var(--accent-primary-text); }


/* --- SIDEBAR & DRAWER COMPONENTS --- */
.content-secondary { display: flex; flex-direction: column; gap: 1.5rem; }
.favorites-section, .area-zip-lookup, .analytics-dashboard { background-color: var(--card-bg); border: 1px solid var(--card-border); border-radius: var(--radius-lg); padding: 1.5rem; box-shadow: 0 4px 12px var(--shadow-color); }
.area-zip-lookup { min-height: 280px; }
.favorites-section.is-expanded { }
.favorites-section h3, .area-zip-heading, .analytics-dashboard h3 { font-family: var(--font-family-headings); font-size: 1.1rem; font-weight: 700; margin: 0 0 1rem 0; }
.favorites-list { list-style: none; padding: 0; margin: 0; }
.favorite-item { display: flex; align-items: center; gap: 0.75rem; padding: 0.5rem; cursor: pointer; border-radius: var(--radius-md); }
.favorite-item:hover { background-color: var(--accent-secondary); }
.favorite-name { flex-grow: 1; font-weight: 500; }
.icon-btn-remove { font-size: 0.9rem; color: var(--text-tertiary); }
.empty-state { font-size: 0.9rem; color: var(--text-tertiary); padding: 1rem 0; text-align: center; }
canvas { max-width: 100%; display: block; }

.lookup-wrapper { position: relative; }
.lookup-form { display: flex; gap: 0.5rem; align-items: center; }
.menu-input {
    width: 100%; flex-grow: 1; padding: 0.5rem 0.75rem;
    font-size: 0.9rem; border: 1px solid var(--card-border);
    background-color: var(--app-bg); color: var(--text-primary);
    border-radius: var(--radius-md); transition: border-color var(--transition-fast) ease-out;
}
.menu-input:focus { border-color: var(--accent-primary); }
.drawer .menu-input { padding-left: 2.25rem; }
.drawer .search-wrapper .search-icon { left: 0.75rem; }
.location-results-box { margin-top: 1rem; max-height: 140px; overflow-y: auto; }
.location-result-title { font-family: var(--font-family-headings); font-weight: 700; margin-bottom: 0.5rem; }
.location-result-list { list-style: none; padding: 0; margin: 0; display: flex; flex-direction: column; gap: 0.25rem; }
.location-result-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 0.75rem;
    padding: 0.75rem;
    border-radius: var(--radius-md);
    cursor: pointer;
    transition: background-color var(--transition-fast) ease-out;
    border: none;
    width: 100%;
    background-color: transparent;
    color: var(--text-primary);
    font-size: 0.9rem;
    text-align: left;
}
.location-result-item:hover { background-color: var(--accent-secondary); }
.location-result-item strong { font-weight: 700; }
.location-result-item span { color: var(--text-secondary); }


/* --- POPOVER, MODAL, DRAWER --- */
.popover-wrapper { position: relative; }
.popover { position: absolute; top: calc(100% + 8px); right: 0; width: 300px; background-color: var(--card-bg); border: 1px solid var(--card-border); border-radius: var(--radius-md); box-shadow: 0 8px 16px var(--shadow-color); z-index: 200; }
.popover-header { font-family: var(--font-family-headings); padding: 0.75rem 1rem; font-weight: 700; border-bottom: 1px solid var(--card-border); }
.popover-content { padding: 0.5rem; }

.toggle-switch { display: flex; align-items: center; justify-content: space-between; cursor: pointer; padding: 0.75rem; font-size: 0.9rem; user-select: none; border-radius: var(--radius-md); position: relative; min-height: 24px; }
.toggle-switch:hover { background-color: var(--accent-secondary); }
.toggle-switch input[type="checkbox"] { position: absolute; opacity: 0; width: 0; height: 0; }
.toggle-switch .switch-label { flex-grow: 1; padding-right: 10px; }
.toggle-switch .switch-track { display: block; width: 44px; height: 24px; background-color: var(--accent-secondary-hover); border-radius: 999px; transition: background-color var(--transition-speed) ease-out; flex-shrink: 0; position: relative; }
.toggle-switch .switch-handle { position: absolute; top: 3px; left: 3px; width: 18px; height: 18px; background-color: white; border-radius: 50%; transition: transform var(--transition-speed) ease-out; box-shadow: 0 1px 3px rgba(0,0,0,0.2); }
.toggle-switch input[type="checkbox"]:checked + .switch-label + .switch-track { background-color: var(--accent-primary); }
.toggle-switch input[type="checkbox"]:checked + .switch-label + .switch-track .switch-handle { transform: translateX(20px); }

.modal-overlay { position: fixed; inset: 0; background-color: rgba(0, 0, 0, 0.5); z-index: 300; display: flex; align-items: center; justify-content: center; padding: 1rem; opacity: 0; pointer-events: none; transition: opacity 0.2s ease-out; }
.modal-overlay.is-open { opacity: 1; pointer-events: auto; }
.modal-content { background-color: var(--card-bg); border-radius: var(--radius-lg); box-shadow: 0 10px 30px var(--shadow-color); width: 100%; max-width: 600px; display: flex; flex-direction: column; max-height: 90vh; }
.modal-header { display: flex; align-items: center; justify-content: space-between; padding: 1rem 1.5rem; border-bottom: 1px solid var(--card-border); }
.modal-header h2 { font-family: var(--font-family-headings); margin: 0; font-size: 1.25rem; }
.modal-body { padding: 1.5rem; overflow-y: auto; list-style: none; margin: 0; }
.directory-item { display: flex; align-items: center; gap: 0.75rem; padding: 0.75rem; font-size: 0.9rem; border-radius: var(--radius-md); }
.directory-item:hover { background-color: var(--accent-secondary); }
.status-dot { width: 8px; height: 8px; border-radius: 50%; flex-shrink: 0; }
.status-dot.is-live { background-color: var(--success); }
.status-dot.is-offline { background-color: var(--danger); }
.directory-name { font-weight: 500; flex-grow: 1; }
.directory-tla { font-size: 0.8rem; color: var(--text-tertiary); }

.drawer { position: fixed; top: 0; right: 0; width: clamp(300px, 90vw, 360px); height: 100%; background-color: var(--card-bg); border-left: 1px solid var(--card-border); box-shadow: 0 0 30px var(--shadow-color); z-index: 400; display: flex; flex-direction: column; transform: translateX(100%); transition: transform var(--transition-speed) ease-out; }
.drawer.is-open { transform: translateX(0); }
.drawer-header { display: flex; align-items: center; justify-content: space-between; padding: 0.75rem 1rem; border-bottom: 1px solid var(--card-border); flex-shrink: 0; }
.drawer-title { font-family: var(--font-family-headings); font-size: 1.125rem; margin: 0; font-weight: 700; }
.drawer-content { padding: 1.5rem; overflow-y: auto; display: flex; flex-direction: column; gap: 1.5rem; }

.kb-list { list-style: none; padding: 0; margin-top: 1rem; display: flex; flex-direction: column; gap: 0.5rem; }
.kb-list li a { display: block; padding: 0.75rem; border-radius: var(--radius-md); text-decoration: none; color: var(--text-primary); background-color: var(--accent-secondary); font-weight: 500; font-size: 0.9rem; transition: background-color var(--transition-fast) ease-out, color var(--transition-fast) ease-out; }
.kb-list li a:hover { background-color: var(--accent-secondary-hover); color: var(--accent-primary); }


/* --- TOOLTIPS --- */
[data-tooltip] { position: relative; }
[data-tooltip]::after {
    content: attr(data-tooltip);
    opacity: 0;
    pointer-events: none;
    transition: opacity var(--transition-fast) ease-out, transform var(--transition-fast) ease-out;
    position: absolute;
    left: 50%;
    transform: translateX(-50%) translateY(5px);
    top: calc(100% + 8px);
    z-index: 500;
    background: var(--tooltip-bg);
    color: var(--tooltip-text);
    font-size: 0.8rem;
    font-weight: 600;
    padding: 0.4rem 0.8rem;
    border-radius: var(--radius-md);
    white-space: nowrap;
}
[data-tooltip][data-shortcut]::after {
    content: attr(data-tooltip) " (" attr(data-shortcut) ")";
}
[data-tooltip]:hover::after {
    opacity: 1;
    transform: translateX(-50%) translateY(0);
}


/* --- ANIMATIONS --- */
@keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }


/* --- RESPONSIVENESS --- */
@media (max-width: 640px) {
    .app-main { padding: 1rem; }
    .search-input { font-size: 1rem; }
    .card-header { flex-direction: column; align-items: flex-start; gap: 0.5rem; }
    .card-title { font-size: 1.25rem; }
    .drawer-content { padding: 1rem; }
    .biller-action-bar { flex-direction: column; align-items: flex-start; }
}


/* --- NEW: COMPACT DENSITY MODE --- */
/* These rules apply when the body has the .density-compact class */
body.density-compact .app-main { padding: 1rem 1.5rem; }
body.density-compact .biller-card,
body.density-compact .favorites-section, 
body.density-compact .area-zip-lookup, 
body.density-compact .analytics-dashboard { padding: 1rem; }
body.density-compact .card-header { padding-bottom: 0.75rem; }
body.density-compact .card-title { font-size: 1.5rem; }
body.density-compact .search-input { padding-top: 0.75rem; padding-bottom: 0.75rem; font-size: 1.1rem; }
body.density-compact .biller-action-bar { margin: 1rem 0; }
body.density-compact .btn-biller-card { padding: 0.5rem 1rem; font-size: 0.85rem; }
body.density-compact .suggestion-item { padding: 0.6rem 1rem; }
body.density-compact .favorite-item { padding: 0.4rem; }
body.density-compact .directory-item { padding: 0.6rem; }